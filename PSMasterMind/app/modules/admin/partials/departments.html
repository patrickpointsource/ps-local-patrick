<div class="departments-container" ng-controller="DepartmentsCtrl">
	<div class="row department-category">
		<div class="col-md-12">
			<div class="row section-header category-container">
				<div class="col-md-12">
					<div class="form-inline ">
						<div class="col-md-9">
							<div class="form-group">
								<label class="category-lbl">Select a category</label>
								
								<div class="select-editable">
									<select name="departmentCategories" class="form-control pull-right" ng-change="onCategoryChanged($event, this)" 
				                                    ng-model="selectedCategory"
				                                    ng-required="true"
				                                    ng-options="p.name for p in departmentCategories track by p.trimmedValue"></select>
			                     
			                    	 <input type="text" name="format" ng-model="selectedCategory.trimmedValue" ng-show="selectedCategory.isEdit" />
			                    </div>
			                    
			                    <button ng-show="selectedCategory.name" ng-disabled="false" ng-click="onDeleteCategory()" class="btn btn-default">
			                    	<span class="hidden-sm hidden-xs visible-lg-inline visible-md-inline">Delete</span>
			                    	<i class="visible-sm-inline visible-xs-inline hidden-lg hidden-md fa fa-trash-o"></i>
		                    	</button>
								<button ng-show="!selectedCategory.isEdit && selectedCategory.name" ng-disabled="false" ng-click="onEditCategory()" class="btn btn-default">
									<span class="hidden-sm hidden-xs visible-lg-inline visible-md-inline">Edit category</span>
									<i class="visible-sm-inline visible-xs-inline hidden-lg hidden-md fa fa-pencil"></i> 
								</button>
					   			
					   			
					   			<button ng-show="selectedCategory.isEdit" class="btn btn-default" ng-click="saveDepartmentCategory($event)" >
					   				<span class="hidden-sm hidden-xs visible-lg-inline visible-md-inline">Save changes</span>
					   				<i class="visible-sm-inline visible-xs-inline hidden-lg hidden-md fa fa-save"></i> 
				   				</button> 
				   				             
		                    	<button ng-show="!selectedCategory.isEdit" ng-click="onCreateCategory($event)"
									class="btn btn-default visible-sm-inline-block visible-xs-inline-block hidden-lg hidden-md create-category-btn">
							  		<i class="visible-sm-inline visible-xs-inline hidden-lg hidden-md fa fa-plus"></i> 
								</button>
			
		                    </div>
					   </div>
					   <div class="col-md-3 hidden-sm hidden-xs">
					   		<button ng-show="!selectedCategory.isEdit" class="btn btn-default pull-right create-category-btn" ng-click="onCreateCategory($event)" >Create new category</button>
					   	</div>
				   	</div>
			   	</div>
			</div>
		</div>
	</div>
	<div class="row departments">
		<div class="col-md-4 col-xs-6 left">
			<div class="row section-header">
				<div class="col-xs-12">
					<label>Department</label>
					<button ng-click="onCreateDepartment($event)"
							class="btn btn-default visible-sm-inline-block visible-xs-inline-block hidden-lg hidden-md create-category-btn">
					  		<i class="fa fa-plus"></i> 
						</button>
								
					<div class="search-departments-lbl">Search or select a department to see details</div>
					
					<div class="input-group search-department-control">
				        <input type="text" class="form-control" ng-model="searchDeptStr" placeholder="Enter a mgr, nickname, code" ng-change="searchDepartments($event)">
				        <span class="input-group-addon"><i class="fa fa-search"></i></span>
				   </div>
			   </div>
			</div>
			<div class="row section-content">
				<div class="col-xs-12">
					<div ng-repeat="dep in availableDepartments" class="department-entry" ng-click="selectDepartment($event, dep)" ng-show="!dep.hidden">
						<span class="code" ng-show="!dep.departmentCategory || !dep.departmentCategory.isEmptyCategory">{{dep.departmentCode.name}}</span>
						<span class="empty-category" ng-show="dep.departmentCategory.isEmptyCategory"><i class="fa fa-exclamation-triangle"></i></span>
						<span class="manager">{{dep.departmentManager.name}}</span>
						<span class="nickname">{{dep.departmentNickname}}</span>
					</div>
				</div>
			</div>
			
		</div>
		<div class="col-md-4 col-xs-6 middle">
		    <!-- Edit form
		        !-->
		    <div class="department-edit-container" ng-if="selectedDepartment.isNew || selectedDepartment._id && selectedDepartment.isEdit">
		        <form name="selectedDepartmentForm" novalidate>
                    <div class="section-header row">
                        <div class="col-xs-6">
                            <label>Department <span ng-if="selectedDepartment.departmentCode">{{selectedDepartment.departmentCode.name}}</span> Details</label>
                        </div>
                        <div class="col-xs-6">
                        	<input type="submit" ng-disabled="!selectedDepartmentForm.$dirty" class="btn pull-right hidden-xs hidden-sm hidden-md visible-lg-inline-block" value="Save" ng-click="saveDepartmentPeople()">
                            <input type="submit" class="btn pull-right hidden-xs hidden-sm hidden-md visible-lg-inline-block" style="margin-right: 5px;" value="Cancel" ng-click="cancelDepartment()">
                            
                            <button ng-disabled="!selectedDepartmentForm.$dirty"  class="btn pull-right hidden-lg visible-md-inline-block visible-sm-inline-block visible-xs-inline-block " ng-click="saveDepartmentPeople()">
				            	<i class="fa fa-save"></i>
				            </button>
				            
				            <button class="btn pull-right hidden-lg visible-md-inline-block visible-sm-inline-block visible-xs-inline-block " ng-click="cancelDepartment()" style="margin-right:4px;">
				            	<i class="fa fa-chevron-left"></i> 
				            </button>
			            
                        </div>
                    </div>
                    <div class="section-content row">
                        <div class="col-xs-12">
                            <label class="required-label control-label" for="role">Department code:</label>
                            <input class="form-control" name="deptCode" ng-required="true" placeholder="Search for an availalble code"
                                   ng-model="selectedDepartment.departmentCode" typeahead-min-length="1" highlight="true" ng-disabled="!selectedDepartment.isNew"
                                   typeahead="p as p.name for p in currentDepartmentCodes | filter:{name:$viewValue}" />
                        </div>
                        <div class="col-xs-12 ">
                            <label class="required-label control-label" for="role">Department category:</label>



                            <select name="deptCategory" class="form-control pull-right"
                                    ng-model="selectedDepartment.departmentCategory"
                                    ng-required="true"
                                    ng-options="p.name for p in departmentCategories track by p.trimmedValue"></select>

                        </div>
                        <div class="col-xs-12">
                            <label class="required-label control-label" for="role">Department nickname:</label>
                            <input class="form-control" name="deptName" ng-required="true" placeholder="Nicknames must be unique" ng-model="selectedDepartment.departmentNickname" />
                        </div>
                        <div class="col-xs-12">
                            <label class="control-label" for="role">Department manager:</label>

                            <input class="form-control" name="deptManager" ng-model="selectedDepartment.departmentManager" typeahead-on-select="selectedManagerChanged($event, $item)"
                                   placeholder="Search for a person" typeahead-min-length="1" highlight="true" typeahead="p as p.name for p in managersList | filter:{name:$viewValue}" />


                        </div>


                    </div>

                    <div class="section-header row">
                        <div class="col-xs-7">
                            <label>Department <span ng-if="selectedDepartment.departmentCode">{{selectedDepartment.departmentCode.name}}</span>  People</label>
                        </div>
                        <div class="col-xs-5">

                            <input type="submit" ng-show="selectedDepartment.editDepartmentPeople" ng-disabled="selectedDepartmentForm.$invalid" 
                            	class="btn pull-right hidden-xs hidden-sm hidden-md visible-lg-inline-block" style="margin-right:4px;" value="Save" ng-click="saveDepartmentPeople()">
                            <input type="submit" ng-show="selectedDepartment.editDepartmentPeople" ng-disabled="selectedDepartmentForm.$invalid" 
                            	class="btn pull-right hidden-xs hidden-sm hidden-md visible-lg-inline-block" value="Cancel" ng-click="cancelDepartmentPeople()">
                            <input type="submit" ng-show="!selectedDepartment.editDepartmentPeople" ng-disabled="selectedDepartmentForm.$invalid" 
                            	class="btn pull-right hidden-xs hidden-sm hidden-md visible-lg-inline-block" value="Edit" ng-click="onEditDepartmentPeople()">
                        
                        	<button ng-show="selectedDepartment.editDepartmentPeople" ng-disabled="!departmentPeopleChanged" 
				        		class="btn pull-right hidden-lg visible-md-inline-block visible-sm-inline-block visible-xs-inline-block " style="margin-left:4px;" ng-click="saveDepartmentPeople()">
				            	<i class="fa fa-save"></i>
				            </button>
				            
				        	<button ng-show="selectedDepartment.editDepartmentPeople" ng-disabled="selectedDepartmentForm.$invalid" 
				        		class="btn pull-right hidden-lg visible-md-inline-block visible-sm-inline-block visible-xs-inline-block " ng-click="cancelDepartmentPeople()">
				            	<i class="fa fa-chevron-left"></i>
				            </button>
				            
				            <button ng-show="!selectedDepartment.editDepartmentPeople" ng-disabled="selectedDepartmentForm.$invalid" 
				            	class="btn pull-right hidden-lg visible-md-inline-block visible-sm-inline-block visible-xs-inline-block " ng-click="onEditDepartmentPeople()" style="margin-right:4px;">
				            	<i class="fa fa-pencil"></i> 
				            </button>
				            
                        </div>
                    </div>
                    <div class="section-content row">
                        <div class="col-xs-12">
                            <div ng-if="selectedDepartment.editDepartmentPeople">
                                <div ng-repeat="p in selectedDepartmentPeople" class="available-person">
                                    <span class="name">{{p.name}}</span>
                                    <span class="add pull-right" ng-click="removeDepartmentPerson(p)">
                                        <i class="fa fa-times"></i>
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="col-xs-12">
                            <div ng-if="!selectedDepartment.editDepartmentPeople">
                                <div ng-repeat="p in selectedDepartmentPeople">
                                    {{p.name}}
                                </div>
                            </div>
                        </div>


                    </div>
                </form>
		    </div>
			
			<!-- 
				View form
			!-->
			<div ng-form="selectedDepartmentForm" class="department-edit-container" ng-if="selectedDepartment._id && !selectedDepartment.isEdit">
			    <div class="row section-header">
			    	<div class="col-xs-12">
			    		<label>Department Details</label>
			    	
			            <input type="submit" ng-disabled="selectedDepartmentForm.$invalid" class="btn pull-right hidden-xs hidden-sm hidden-md visible-lg-inline-block" value="Edit" ng-click="editDepartment()">
			            <input type="submit" ng-disabled="selectedDepartmentForm.$invalid" class="btn pull-right  hidden-xs hidden-sm hidden-md visible-lg-inline-block" value="Delete" ng-click="deleteDepartment()" style="margin-right:4px;">
			            
			            <button ng-disabled="selectedDepartmentForm.$invalid" class="btn pull-right hidden-lg visible-md-inline-block visible-sm-inline-block visible-xs-inline-block " ng-click="editDepartment()">
			            	<i class="fa fa-pencil"></i>
			            </button>
			            
			            <button ng-disabled="selectedDepartmentForm.$invalid" class="btn pull-right hidden-lg visible-md-inline-block visible-sm-inline-block visible-xs-inline-block " ng-click="deleteDepartment()" style="margin-right:4px;">
			            	<i class="fa fa-trash-o"></i> 
			            </button>
			          
			        </div>
			    </div>
			    <div class="row section-content view-container">
			    	<div class="col-xs-12">
		               <label class="control-label" >Department code:</label>
		               
		               <span>{{selectedDepartment.departmentCode.name}}</span>
		               
		           </div>
			        <div class="col-xs-12 ">
		               <label class="control-label" >Department category:</label>
		               
		               <span ng-show="!selectedDepartment.departmentCategory.isEmptyCategory">{{selectedDepartment.departmentCategory.name}}</span>
		               <span class="empty-department-category" ng-show="selectedDepartment.departmentCategory.isEmptyCategory">This department does not have an assigned category</span>
		           </div>
		           <div class="col-xs-12">
		               <label class="control-label" >Department nickname:</label>
		               
		               <span>{{selectedDepartment.departmentNickname}}</span>
		              
		           </div>
			       <div class="col-xs-12">
		               <label class="control-label" for="departmentManager.name">Department manager:</label>
		              
		               <span>{{selectedDepartment.departmentManager.name}}</span>
		           		
		           </div>
			       
			              
			    </div>
			    
			    <div class="row section-header" >
			    	<div class="col-xs-7">
			    		<label>Department <span ng-if="selectedDepartment.departmentCode">{{selectedDepartment.departmentCode.name}}</span>  People</label>
			    	</div>
			        <div class="col-xs-5">
			            
                        <input type="submit" ng-show="selectedDepartment.editDepartmentPeople" ng-disabled="!departmentPeopleChanged" class="btn pull-right hidden-xs hidden-sm hidden-md visible-lg-inline-block" style="margin-left:4px;" value="Save" ng-click="saveDepartmentPeople()">
			            <input type="submit" ng-show="selectedDepartment.editDepartmentPeople" ng-disabled="selectedDepartmentForm.$invalid" class="btn pull-right hidden-xs hidden-sm hidden-md visible-lg-inline-block" value="Cancel" ng-click="cancelDepartmentPeople()">
			            <input type="submit" ng-show="!selectedDepartment.editDepartmentPeople" ng-disabled="selectedDepartmentForm.$invalid" class="btn pull-right hidden-xs hidden-sm hidden-md visible-lg-inline-block" value="Edit" ng-click="onEditDepartmentPeople()" >
			        
			        	<button ng-show="selectedDepartment.editDepartmentPeople" ng-disabled="!departmentPeopleChanged" 
			        		class="btn pull-right hidden-lg visible-md-inline-block visible-sm-inline-block visible-xs-inline-block " style="margin-left:4px;" ng-click="saveDepartmentPeople()">
			            	<i class="fa fa-save"></i>
			            </button>
			            
			        	<button ng-show="selectedDepartment.editDepartmentPeople" ng-disabled="selectedDepartmentForm.$invalid" 
			        		class="btn pull-right hidden-lg visible-md-inline-block visible-sm-inline-block visible-xs-inline-block " ng-click="cancelDepartmentPeople()">
			            	<i class="fa fa-chevron-left"></i>
			            </button>
			            
			            <button ng-show="!selectedDepartment.editDepartmentPeople" ng-disabled="selectedDepartmentForm.$invalid" 
			            	class="btn pull-right hidden-lg visible-md-inline-block visible-sm-inline-block visible-xs-inline-block " ng-click="onEditDepartmentPeople()" style="margin-right:4px;">
			            	<i class="fa fa-pencil"></i> 
			            </button>
			        </div>
			    </div>
			    <div class="row section-content">
			    	<div class="col-xs-12">
				    	<div ng-if="selectedDepartment.editDepartmentPeople">
				    		<div ng-repeat="p in selectedDepartmentPeople" class="available-person">
				    			<span class="name">{{p.name}}</span>
									<span class="add pull-right" ng-click="removeDepartmentPerson(p)">
										<i class="fa fa-times"></i>
									</span>
			    			</div>
				    	</div>
			    	
				    	<div ng-if="!selectedDepartment.editDepartmentPeople">
				    		<div ng-repeat="p in selectedDepartmentPeople">
				    			{{p.name}}
				    			</div>
				    	</div>
			    	</div>
			    </div>
			</div>
			
	
			
		</div>
		<div class="col-md-4 col-xs-6 right">
			<div class="row section-header"> 
				<div class="col-xs-12">
					<label>Available people</label>
					<div ng-if="!selectedDepartment.editDepartmentPeople">These people are not assigned to any department</div>
					<div ng-if="selectedDepartment.editDepartmentPeople">
						<div class="input-group search-department-control">
					        <input type="text" class="form-control" ng-model="searchAvaialbleStr" placeholder="Enter an employee name" ng-change="searchAvailablePeople($event, this)">
					        <span class="input-group-addon"><i class="fa fa-search"></i></span>
					   </div>
					</div>
				</div>
			</div>
			<div class="row section-content">
				<div class="col-xs-12">
					<div ng-if="!selectedDepartment.editDepartmentPeople">
						<div  ng-repeat="p in availablePeopleList">{{p.name}}</div>
						
					</div>
					
					<div ng-if="selectedDepartment.editDepartmentPeople">
						<div  ng-repeat="p in availablePeopleList" class="available-person cursor-pointer" 
							ng-class="{'already-assigned':p.alreadyAssigned}" ng-click="checkAddDepartmentPerson(p)">
							<span class="name">{{p.name}}</span>
							<span class="add pull-right" >
								<i class="fa fa-plus"></i>
							</span>
						</div>
						
					</div>
				</div>
				
			</div>
			
			<div class="modal fade confirm-delete-category">
			  <div class="modal-dialog">
			    <div class="modal-content">
			      <div class="modal-header">
			        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			        <h4 class="modal-title">Delete category?</h4>
			      </div>
			      <div class="modal-body">
			        Are you sure you want to delete category {{deleteCategoryName}}? All associated departments will need to be assigned to a new category.
			      </div>
			      <div class="modal-footer">
			        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
			        <button type="button" class="btn btn-primary pull-right" ng-click="onDeleteCategoryCb()">Delete</button>
			      </div>
			    </div>
			  </div>
			</div>
			
			<div class="modal fade confirm-delete-department">
			  <div class="modal-dialog">
			    <div class="modal-content">
			      <div class="modal-header">
			        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			        <h4 class="modal-title">Delete department</h4>
			      </div>
			      <div class="modal-body">
			        Are you sure you want to delete this department? All people within department will need to be reassigned to new departments to be included in reports.
			      </div>
			      <div class="modal-footer">
			        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
			        <button type="button" class="btn btn-primary pull-right" ng-click="onDeleteDepartmentCb()">Delete</button>
			      </div>
			    </div>
			  </div>
			</div>
			
		    <div class="modal fade restrict-delete-department">
		        <div class="modal-dialog">
		            <div class="modal-content">
		                <div class="modal-header">
		                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
		                    <h4 class="modal-title">Delete department</h4>
		                </div>
		                <div class="modal-body">
		                    You cannot delete a category that has assigned departments. To delete this category, reassign departments to another category first. Assigned departments include {{departmentCodesToReassign}}.
		                </div>
		                <div class="modal-footer">
		                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
		                </div>
		            </div>
		        </div>
		    </div>
            
            <div class="modal fade confirm-reassign-person">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title">{{reassignedPerson.name}} is already in another department.</h4>
                        </div>
                        <div class="modal-body">
                            Are you sure you want to assign <strong>{{reassignedPerson.name}}</strong> to <strong>[{{selectedDepartment.departmentCode.name}}] {{selectedDepartment.departmentNickname}}</strong>?
</div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                            <button type="button" class="btn btn-primary pull-right" ng-click="addDepartmentPerson(reassignedPerson)">Yes</button>
                        </div>
                    </div>
                </div>
            </div>
			

		</div>
	</div>
	
</div>