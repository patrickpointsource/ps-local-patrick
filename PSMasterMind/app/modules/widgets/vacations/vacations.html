<div ng-controller="VacationsCtrl">
  <div class="panel panel-default dashboard-widget">
    <div class="panel-heading"> 
      <i class="fa fa-briefcase"></i> Out of Office
      <div class="pull-right  btn-group btn-group-sm dashboard-actions">
        <a ng-click="requestHours()" ng-show="me.about == profile.about"><i class="fa fa-plus"></i> New Request</a>
      </div>
    </div>
    <div class="panel-body no-bottom-padding no-horizontal-padding-xs">
<!-- Available vacation days -->
      <div class="row" style="margin-bottom: 0px;" ng-if="profile.vacationCapacity" ng-show="me.about == profile.about">
        <div class="col-xs-12 align-center" style="border-bottom: 1px solid #ededed; padding-bottom: 10px;">
          <h4><span ng-show="me.about == profile.about">You</span><span ng-hide="me.about == profile.about">{{getPersonName(profile)}}</span> have 
             <strong ng-class="{ 'black-text': getCurrentYearVacationDays() > 0, 'gray-text': getCurrentYearVacationDays() <= 0 }">
               {{getCurrentYearVacationDays()}} days 
             </strong>of vacation available for use.
              <i class="fa fa-question-circle" style="color: #1ba2c1;" popover="{{pointSourcePolicy}}" popover-trigger="mouseenter"></i>
           </h4>
        </div>
      </div>
      <div class="row no-vertical-margin" ng-show="vacations.length == 0" style="padding-top: 10px; padding-bottom: 10px; text-align: center;">
        <h5 style="font-size: 16px;">There are no current requests.</h5>
      </div>
      
<!-- Errors -->
      <div class="row alert alert-danger" ng-show="errors.length > 0">
        <ul>
          <li ng-repeat="error in errors">{{error}}</li>
        </ul>
      </div>

<!-- New Request -->
      <div class="row" ng-show="requestNew">
        <div class="row col-xs-12 no-horizontal-padding horizontal-padding-xs" style="margin: 10px 0 10px 15px;">
          <span style="font-weight: bold; color: #808080; font-size: 15px;">New Request</span>
          <i class="fa fa-times cursor-pointer pull-right color-gray-image-border" style="padding-right: 30px;" ng-click="requestHours()"></i>
        </div>
        <div class="row col-xs-12 no-horizontal-margin no-horizontal-padding horizontal-padding-xs" style="margin-bottom: 5px;">
          <div class="col-xs-12">
            <div ng-show="vacationManager && !editManager" class="vac-approving-manager">Your request will be sent to <span class="color-gray-less bold">{{getPersonName(vacationManager)}}</span><i class="fa fa-pencil cursor-pointer padding-left-10" ng-click="editManagerCallback()" ng-show="!editManager"></i></div>
          </div>
          <div class="col-xs-12 col-md-6">
            <div ng-show="editManager">
              <select ng-options="getPersonName(m) for m in managers" class="selectpicker select-vacation-manager" data-style="btn-info" ng-model="vacationManager" ng-change="managerSelected()" name="vacationManager">
                <option selected value="" ng-hide="vacationManager">Select manager</option>
              </select>
            </div>
            <div id="vacationType">
            	<select class="selectpicker select-vacation-start-date" data-style="btn-info" ng-model="vacationType" name="vacationType">
              		<option selected value="" ng-hide="vacationType">Type of Request</option>
               		<option ng-repeat="vacationType in vacationTypes" value="{{vacationType}}">{{vacationType}}</option>
             	</select>
            </div>
          </div>
          <div class="col-xs-12 col-md-6">
            <!--<i class="fa fa-pencil cursor-pointer padding-left-10" ng-click="editManagerCallback()" ng-show="editManager"></i>-->
          </div>
        </div>
        <div ng-if="vacationType" class="row col-xs-12 vacation-dates-row no-margin padding-bottom-5 horizontal-padding-xs visible-lg">
          <div class="gray-text">From</div>
          <div class="gray-text" style="margin-left: 49%;">Until</div>
        </div>
        <div ng-if="vacationType" class="row col-xs-12 vacation-dates-row no-horizontal-margin horizontal-padding-xs visible-lg">
          <div class="vac-dates-date">
            <input id="vacationFromDate" name="vacationFromDate" ng-init="START_TIME_DEFAULT" class="form-control datepicker fa-calendar" type="text" placeholder="Start Date" ng-model="vacationStartDate" ng-change="dateChanged()" data-date-format="yyyy-mm-dd" data-provide="datepicker"/>
          </div>
          <div class="vac-dates-time">
            <input class="form-control" type="time" ng-model="vacationStartTime" ng-change="dateChanged()"/>
          </div>
          <div class="vac-dates-arrow">
            <i class="fa fa-long-arrow-right fa-2x hidden-xs" style="color: #ededed;"></i>
          </div>
          <div class="vac-dates-date">
            <input id="vacationToDate" name="vacationToDate" class=" form-control datepicker" type="text" placeholder="End Date" ng-model="vacationEndDate" ng-change="dateChanged()" data-date-format="yyyy-mm-dd" ng-disabled="!vacationStartDate" data-provide="datepicker" data-date-start-date="{{vacationStartDate}}">
          </div>
          <div class="vac-dates-time">
            <input class="form-control no-right-padding" type="time" ng-model="vacationEndTime" ng-change="dateChanged()"/>
          </div>
        </div>
        <div ng-if="vacationType" class="row col-xs-12 no-horizontal-margin horizontal-padding-xs hidden-lg">
          <div class="col-xs-12 gray-text no-left-padding">From:
          </div>
            <div class="col-xs-12 col-sm-6 no-horizontal-padding-xs no-left-padding padding-right-xs margin-bottom-xs padding-left-xs">
              <input id="vacationFromDate" name="vacationFromDate" ng-init="START_TIME_DEFAULT" class=" form-control datepicker" type="text" placeholder="Start Date" ng-model="vacationStartDate" data-date-format="yyyy-mm-dd" data-provide="datepicker" ng-change="dateChanged()">
            </div>
            <div class="col-xs-12 col-sm-6 no-horizontal-padding-xs no-right-padding padding-right-xs margin-bottom-xs padding-left-xs">
              <input class="form-control" type="time" ng-model="vacationStartTime"/>
            </div>
            <div class="col-xs-12 gray-text no-left-padding">Until:</div>
            <div class="col-xs-12 col-sm-6 no-horizontal-padding-xs no-left-padding padding-right-xs margin-bottom-xs padding-left-xs">
              <input id="vacationToDate" name="vacationToDate" class=" form-control datepicker" type="text" placeholder="End Date" ng-model="vacationEndDate" data-date-format="yyyy-mm-dd" ng-disabled="!vacationStartDate" data-provide="datepicker" data-date-start-date="{{vacationStartDate}}" ng-change="dateChanged()">
            </div>
            <div class="col-xs-12 col-sm-6 no-horizontal-padding-xs no-right-padding padding-right-xs margin-bottom-xs padding-left-xs">
              <input class="form-control no-right-padding" type="time" ng-model="vacationEndTime"/>
            </div>
        </div>
        
        <div ng-if="vacationType" class="row col-xs-12 no-horizontal-margin padding-top-10 no-horizontal-padding horizontal-padding-xs">
          <!--<div class="visible-xs col-xs-12 color-gray-image-border">Days:</div>
          <div class="col-xs-12 col-sm-4 margin-bottom-xs padding-left-xs"><input type="text" class="form-control" value="{{getDays(vacationStartDate, vacationEndDate)}}" disabled/></div>-->
          <div class="visible-xs col-xs-12 color-gray-image-border">Description:</div>
          <div class="col-xs-12 margin-bottom-xs padding-left-xs">
            <input type="text" placeholder="Description" ng-model="newDescription" class="form-control" ng-change="newDescChanged()"/>
          </div>
        </div>
        <div ng-if="vacationType" class="row col-xs-12 no-horizontal-padding margin-bottom-xs margin-right-xs vertical-margin-md">
          <button class="btn btn-info pull-right" ng-click="addVacation()" style="color: white; font-weight: bold; font-size: 16px;" ng-disabled="submitting">SUBMIT</button>
          <span class="pull-right gray-text vac-requested"><span class="color-gray-less bold">{{getNewVacationDuration()}}</span> requested</span>
        </div>
      </div>

<!-- Vacations -->
      <div class="row no-horizontal-margin-xs vac-row" ng-repeat="vacation in displayedVacations">
        
        <!-- View -->
        <div class="row col-xs-12 no-horizontal-margin no-horizontal-padding" ng-hide="editVacationIndex == $index">
          <div class="col-xs-5 vac-first-col">
            {{displayDate(vacation.startDate)}} <span ng-hide="isSameDay(vacation.startDate, vacation.endDate)">- {{displayDate(vacation.endDate)}}</span>
            <span style="color: #808080; font-weight: 500;">({{getDays(vacation.startDate, vacation.endDate)}})</span>
          </div>
          <div class="col-xs-2 no-horizontal-padding vac-type">{{getTypeText(vacation.type)}}</div>
          <div class="col-xs-4 no-horizontal-padding align-center" ng-class="{'assignment-green': vacation.status === 'Approved', 'assignment-red': vacation.status === 'Denied' || vacation.status === 'Cancelled', 'color-yellow': vacation.status === 'Pending'}">
            <i class="fa fa-check" ng-show="vacation.status === 'Approved'"></i>
            <i class="fa fa-clock-o" ng-show="vacation.status === 'Pending'"></i>
            <span ng-class="{'bold-text': vacation.status == 'Approved' || vacation.status == 'Denied'}">{{getStatusText(vacation.status)}}</span>
          </div>
          <div class="col-xs-1 no-left-padding"><i class="fa fa-pencil cursor-pointer pull-right color-gray-image-border" ng-click="editVacation($index)" ng-show="me.about == profile.about"></i></div>
        </div>
        
        <!-- Edit -->
        <div class="row col-xs-12 no-horizontal-margin no-horizontal-padding" ng-show="editVacationIndex == $index">
          <div class="row col-xs-12" style="margin-left: 0px; margin-right: 0px; margin-bottom: 10px; padding-left: 0px; padding-left: 0px;">
            <div class="col-xs-8" style="font-size: 15px;"><strong>Request</strong> <span class="color-gray-image-border">submitted on {{vacation.created}}</span></div>
            <div class="col-xs-3 align-center" ng-class="{'assignment-green': vacation.status === 'Approved', 'assignment-red': vacation.status === 'Denied' || vacation.status === 'Cancelled', 'color-yellow': vacation.status === 'Pending'}">
              <i class="fa fa-check" ng-show="vacation.status === 'Approved'"></i>
              <i class="fa fa-clock-o" ng-show="vacation.status === 'Pending'"></i>
              <span ng-class="{'bold-text': vacation.status == 'Approved' || vacation.status == 'Denied'}">{{getStatusText(vacation.status)}}</span>
            </div>
            <div class="col-xs-1 no-padding"><i class="fa fa-times cursor-pointer pull-right color-gray-image-border" ng-click="editVacation($index)"></i></div>
          </div>
          <div class="row col-xs-12 no-margin no-horizontal-padding">
            <div class="col-xs-12">
              <div ng-if="profile.manager && !editManagerEdit" class="vac-approving-manager">Your request will be sent to <span class="color-gray-less bold">{{getPersonName(vacationManagerEdit)}}</span><i class="fa fa-pencil cursor-pointer padding-left-10" ng-click="editManagerEditCallback($index)" ng-show="!editManagerEdit"></i></div>
            </div>
            <div class="col-xs-12 col-sm-6">
              <select ng-if="editManagerEdit" ng-options="getPersonName(m) for m in managers" class="selectpicker select-vacation-manager-{{$index}}" data-style="btn-info" ng-model="vacationManagerEdit" ng-change="managerEditSelected()" name="{{'vacationManagerEdit' + $index}}">
              </select>
              <select class="selectpicker select-vacation-start-date-edit" data-style="btn-info" ng-model="vacation.type"
                 ng-options="v as v for v in vacationTypes"
                 ng-change="vacationTypeSelected()"
                 class="form-control" name="vacationType">
               </select>
            </div>
            <div class="row col-xs-12 col-sm-6 no-right-padding">
              <i class="fa fa-pencil cursor-pointer padding-left-10" ng-click="editManagerEditCallback($index)" ng-show="editManagerEdit"></i>
            </div>
          </div>
        <div class="row col-xs-12 vacation-dates-row no-margin padding-bottom-5 horizontal-padding-xs visible-lg">
          <div class="gray-text">From</div>
          <div class="gray-text" style="margin-left: 49%;">Until</div>
        </div>
        <div class="row col-xs-12 vacation-dates-row no-horizontal-margin horizontal-padding-xs visible-lg">
          <div class="vac-dates-date">
            <input id="vacationEditFromDate + $index" name="vacationEditFromDate" class="form-control datepicker fa-calendar" type="text" placeholder="Start Date" ng-model="vacationEditStartDate" ng-change="dateChanged()" data-date-format="yyyy-mm-dd" data-provide="datepicker"/>
          </div>
          <div class="vac-dates-time">
            <input class="form-control" type="time" ng-model="vacationEditStartTime" ng-change="dateChanged()"/>
          </div>
          <div class="vac-dates-arrow">
            <i class="fa fa-long-arrow-right fa-2x hidden-xs" style="color: #ededed;"></i>
          </div>
          <div class="vac-dates-date">
            <input id="vacationToDate + {{$index}}" name="vacationEditToDate + {{$index}}" class=" form-control datepicker" type="text" placeholder="End Date" ng-model="vacationEditEndDate" ng-change="dateChanged()" data-date-format="yyyy-mm-dd" data-provide="datepicker" data-date-start-date="{{vacationEditStartDate}}">
          </div>
          <div class="vac-dates-time">
            <input class="form-control no-right-padding" type="time" ng-model="vacationEditEndTime" ng-change="dateChanged()"/>
          </div>
        </div>
          <div class="row col-xs-12 no-horizontal-margin hidden-lg">
            <div class="col-xs-12 gray-text no-horizontal-padding-xs no-left-padding">From:
            </div>
            <div class="col-xs-12 col-sm-6 no-horizontal-padding-xs no-left-padding margin-bottom-xs">
              <input id="vacationFromDate + $index" name="vacationEditFromDate + $index" class=" form-control datepicker" type="text" placeholder="Start Date" ng-model="vacationEditStartDate" data-date-format="yyyy-mm-dd" data-provide="datepicker" ng-change="dateChanged($index)">
            </div>
            <div class="col-xs-12 col-sm-6 no-horizontal-padding-xs no-right-padding margin-bottom-xs">
              <input class="form-control" type="time" ng-model="vacationEditStartTime"/>
            </div>
            <div class="col-xs-12 gray-text no-horizontal-padding-xs no-left-padding">Until:</div>
            <div class="col-xs-12 col-sm-6 no-horizontal-padding-xs no-left-padding margin-bottom-xs">
              <input id="vacationEditToDate + $index" name="vacationEditToDate + $index" class=" form-control datepicker" type="text" placeholder="End Date" ng-model="vacationEditEndDate" data-date-format="yyyy-mm-dd" data-provide="datepicker" data-date-start-date="{{vacationStartDate}}">
            </div>
            <div class="col-xs-12 col-sm-6 no-horizontal-padding-xs no-right-padding margin-bottom-xs">
              <input class="form-control no-right-padding" type="time" ng-model="vacationEditEndTime"/>
            </div>
          </div>
          <div class="row col-xs-12 no-horizontal-margin no-horizontal-padding padding-top-10">
            <div class="visible-xs col-xs-12 color-gray-image-border">Description:</div>
            <div class="col-xs-12 margin-bottom-xs padding-left-xs">
              <input type="text" placeholder="Description" ng-model="vacation.description" class="form-control"/>
            </div>
          </div>
          <div class="row col-xs-12 no-horizontal-margin no-horizontal-padding">
            <div class="col-xs-12" ng-if="vacation.comment">Comment from {{getPersonName(vacationManagerEdit)}}:</div>
            <div class="col-xs-12 color-gray-image-border italic margin-bottom-xs padding-left-xs" ng-if="vacation.comment">
              "{{vacation.comment}}"
            </div>
          </div>
          
          <div class="row col-xs-12 no-horizontal-margin margin-bottom-xs vertical-margin-md">
              <button class="btn btn-default" data-toggle="modal" data-target="#vacCancelModal" style="color: red; border: 0px; background-color: #f7f7f7;" ng-disabled="submitting">Cancel Request</button>
              <button class="btn btn-info pull-right" ng-click="updateVacation(vacation)" style="background-color: #1ba2c1; color: white; font-size: 16px; font-weight: bold;" ng-disabled="submitting">RESUBMIT</button>
            <span class="pull-right gray-text vac-requested"><span class="color-gray-less bold">{{getEditVacationDuration()}}</span> requested</span>
          </div>
        </div>
      </div>
      
      <!-- Pagination -->
        <div class="row col-xs-12 no-horizontal-margin no-horizontal-padding" style="background-color: white; margin-top: 15px;" ng-show="vacations.length > 3">
          <div class="col-xs-1 no-padding" ng-hide="vacationsPage == 1" ng-click="prevPage()"><i class="fa fa-caret-left"></i></div>
          <div class="col-xs-1 no-padding" ng-show="vacationsPage == 1"></div>
          <div class="col-xs-10 align-center"><span style="color: #808080;">Page {{vacationsPage}}</span> <span style="color:#c1c1c1;">of {{allPages}}</span></div>
          <div class="col-xs-1 align-right no-padding" ng-hide="vacationsPage == allPages" ng-click="nextPage()"><i class="fa fa-caret-right"></i></div>
          <div class="col-xs-1 align-right no-padding" ng-show="vacationsPage == allPages"></div>
        </div>
    </div>
  </div>
  <div class="modal fade" id="vacCancelModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Cancel out-of-office request</h4>
      </div>
      <div class="modal-body">
        <div class="alert alert-danger" ng-show="cancelValidation">
          {{cancelValidation}}
        </div>
        <div class="row horizontal-padding-15">Are you sure you want to cancel your out-of-office request? If so, please provide a reason.</div>
        <div class="row horizontal-padding-15"><input class="form-control" type="text" ng-model="cancellationReason" placeholder="Cancellation reason" required/></div>
      </div>
      <div class="modal-footer">
        <div>
          <a class="cursor-pointer" data-dismiss="modal">No</a>
        </div>
        <button ng-click="deleteVacation()" type="button" class="btn btn-modal-primary pull-right">YES</button>
      </div>
      </div>
    </div>
  </div>
</div>